// Imports
@import url('http://fonts.googleapis.com/css?family=Lobster+Two:700|Roboto:300,700|Roboto+Slab:700')

// Web fonts
@font-face
	src: url('/static/font/baba-icons.svg') format('svg')
	font-family: baba-icons
	font-style: normal
	font-weight: normal

// Design settings
$font-logo = 'Lobster Two', sans-serif
$font-main = Roboto, sans-serif
$font-quote = 'Roboto Slab', serif
$font-icon = baba-icons
$line-height = 1.7em
$color-foreground = #2e281f
$color-foreground-1 = desaturate(lighten($color-foreground, 30), 10)
$color-foreground-2 = desaturate(lighten($color-foreground, 50), 10)
$color-foreground-3 = lighten($color-foreground, 70)
$site-width = 70em
$header-height = 3.5em
$gutter = 2em
$half-gutter = ($gutter / 2)
$quarter-gutter = ($gutter / 4)

$color-accent = #d32
$color-blue = #47c
$color-red = #d32
$color-yellow = #e92
$color-green = #7a3

// CSS reset
global-reset()

// Icons
.icon
	font: normal 1em/1em $font-icon
	&.icon-add
		&::before
			content: '\e800'
	&.icon-delete
		&::before
			content: '\e801'
	&.icon-refresh
		&::before
			content: '\e803'
	&.icon-cog
		&::before
			content: '\e806'
	&.icon-speaker
		&::before
			content: '\e807'
	&.icon-plugin
		&::before
			content: '\e810'
	&.icon-folder
		&::before
			content: '\e811'
	&.icon-add-folder
		&::before
			content: '\e811'
	&.icon-edit
		&::before
			content: '\e813'
	&.add
		&::after
			content: '\e800'
			position: absolute
			color: $color-green !important
			bottom: 0
			left: -.3em
			font-size: .8em
			text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff

// Main elements
p
	margin: $half-gutter 0

strong
	font-weight: 700

a
	color: $color-accent
	transition: all .2s ease
	&:hover
		color: lighten($color-accent, 15)

pre
	overflow: auto
	font: normal 1em monospace
	padding: $half-gutter
	background: $color-foreground-3

&::selection
	background: $color-foreground-2
	color: #fff
	text-shadow: none

[contenteditable]
	cursor: text !important
	$color-hover = rgba($color-foreground, .1)
	&:hover
		text-shadow: 1px 1px 0 $color-hover, 1px -1px 0 $color-hover, -1px 1px 0 $color-hover, -1px -1px 0 $color-hover
	&:empty
		display: inline
		&:before
			content: attr(placeholder)
			color: rgba(#000, .3)

// Form elements
input
	font: 300 .9em/1.9em $font-main
	height: 1.9em
	transition: all .2s

textarea
	font: 300 .9em $font-main

input, textarea
	box-sizing: border-box
	margin: 0
	padding: 0 $quarter-gutter
	outline: none !important
	display: inline-block
	border: none
	&.input-text
		background: #fff
		box-shadow: inset 0 1px 1px rgba(#000, .3), inset 0 -1px 1px rgba(#000, .05)
		&:focus
			box-shadow: inset 0 1px 1px rgba(#000, .3), inset 0 -1px 1px rgba(#000, .05), 0 0 10px rgba($color-foreground-3, .5)

.btn
	height: 1.85em
	font: 400 .9em/1.7em $font-main
	box-shadow: inset 0 1px 0 rgba(#fff, .2), inset 0 -1px 0 rgba(#000, .3)
	cursor: pointer
	padding: 0 $half-gutter
	position: relative
	background: $color-foreground-1
	color: #fff
	text-shadow: 0 -1px 0 rgba(#000, .7)
	text-align: center
	box-sizing: border-box
	border: 1px solid $color-foreground
	transition: all .1s
	display: inline-block
	user-select: none
	&:hover
		background: $color-foreground
	&.active
		background: $color-green
		&:hover
			background: darken($color-green, 10)

.link-btn
	text-transform: uppercase
	height: 1.7em
	font: 700 .8em/1.7em $font-main
	cursor: pointer
	position: relative
	text-shadow: 0 1px 0 rgba(#fff, .7)
	text-align: center
	box-sizing: border-box
	transition: all .1s
	display: inline-block
	cursor: pointer
	user-select: none
	margin: 0 $quarter-gutter 0 0
	color: $color-foreground-2
	.icon
		color: $color-foreground
		margin: 0 $quarter-gutter 0 0
	&.active
		font-weight: 700
	&:hover
		color: $color-foreground
		border-bottom: 2px solid $color-foreground-3
	&:active
		top: 1px

// Layout
html, body
	font: 300 100%/$line-height $font-main
	color: $color-foreground
	background: #f4f2ef
	cursor: default

header, #contents, footer
	max-width: $site-width
	margin: 0 auto
	padding: 0 $gutter

header, #contents
	box-shadow: 0 10px 40px rgba($color-foreground, .1)

header
	display: flex
	align-items: center
	background: linear-gradient(top, lighten($color-foreground, 15), $color-foreground)
	color: #fff
	height: $header-height
	text-shadow: 0 1px 1px rgba(#000, .5)
	user-select: none
	h1
		flex: 1 1 auto
		display: flex
		font: 1.5em/1 $font-logo
		color: #fff
		align-items: center
		.title
			flex: 1 1 auto
			font-weight: 700
		.catchphrase
			color: lighten($color-foreground-1, 5)
			font: .65em/1 $font-logo
			flex: 0 1 auto
			cursor: pointer
			display: flex
			align-items: center
			&:hover
				color: $color-foreground-2
			div
				display: inline-block
				margin: 0 $quarter-gutter 0 0
			.icon
				display: flex
				&::before
					font-size: .6em
					line-height: 1
					vertical-align: top
	.actions
		.btn
			color: $color-foreground-2
			margin: 0 0 0 $quarter-gutter
			background: lighten($color-foreground, 14)
			font-size: .85em
			&:hover
				color: #fff
				background: lighten($color-foreground, 10)

#contents
	background: #fff
	padding-top: $gutter
	padding-bottom: $gutter

footer
	text-align: center
	color: $color-foreground-2
	text-shadow: 0 1px #fff
	a
		color: @color
		&:hover
			color: $color-foreground-1

// Section styles
section.step
	background: lighten($color-foreground-3, 12)
	border-left: 3px solid $color-foreground
	position: relative
	padding: 0 $half-gutter $half-gutter $gutter
	margin: 0 0 $half-gutter 0
	text-shadow: 0 1px 0 rgba(#fff, .8)
	$header-height = 60px
	$header-padding = 24px
	.number
		position: absolute
		background: $color-foreground
		font-weight: 700
		font-size: 1.15em
		color: #fff
		width: $header-height - $header-padding
		height: @width
		line-height: @height
		text-align: center
		border-radius: 50%
		top: ($header-padding / 2)
		left: -(@width / 2) - 2px
		text-shadow: none
		user-select: none
	.contents
		& > .header
			display: flex
			h1
				font-weight: 700
				font-size: 1.1em
				line-height: $header-height
				user-select: none
				flex: 1 1 auto
				.add
					position: absolute
					right: $half-gutter
					top: $half-gutter
					font-size: .8em
			.add-section
				line-height: $header-height
				margin: 0 $half-gutter 0 0
			ul.tabs
				display: flex
				li
					cursor: pointer
					align-self: flex-end
					padding: 0 $half-gutter .9em $half-gutter
					box-sizing: border-box
					font-size: .8em
					text-transform: uppercase
					color: $color-foreground-1
					user-select: none
					&:hover
						color: $color-foreground
					&.active
						color: $color-foreground
						background: #fff
						font-weight: 700

.name-grammar
	.name .by
		margin: 0 $quarter-gutter
	.comment textarea
		margin: $half-gutter 0 0 0
		width: 100%
		height: 4em

// Builder styles
$builder-gutter = 5px
section.tree
	margin-left: -($half-gutter)
	user-select: none
	background: #fff
	padding: $quarter-gutter 0
	section
		padding: 0 $quarter-gutter 0 $half-gutter
		section
			padding: 0 0 0 $quarter-gutter
		.node-wrapper
			border-left: 1px solid $color-foreground-3
			padding-left: $quarter-gutter
			margin-left: ($quarter-gutter / 2)
		.header
			display: flex
			.add-section
				display: none
			.toggle
				color: $color-foreground-3
				cursor: pointer
				margin: 0 $quarter-gutter 0 0
				&:hover
					color: $color-foreground-2
				&::before
					font-size: .8em
					line-height: 2.2
			.label
				flex: 1 1 auto
				text-transform: uppercase
				font-weight: 700
				border: 0
				text-align: left
				background: transparent
			.comment,
			.tag
				text-align: right
				display: none
			.delete
				color: $color-red
				cursor: pointer
				display: none
				&:hover
					color: darken($color-red, 20)
			.export
				text-transform: uppercase
				font-size: .9em
				.unexported
					opacity: .3
					.btn
						line-height: 1.5em
						height: @line-height
				.exported
					line-height: 1.9em
					color: $color-green
					cursor: pointer
					&:hover
						color: darken($color-green, 20)
					&::before
						font: normal 1em $font-icon
						content: '\e802'
						padding: 0 $quarter-gutter 0 0
			&:hover
				box-shadow: 0 1px 0 $color-foreground-3
				.add-section
					display: block
				.export
					.unexported
						opacity: 1
				.comment,
				.tag
					display: block
				.delete
					display: block


.builder
	cursor: default
	background: #f4f2ef
	box-shadow: inset 0 1px 2px rgba(#000, .1)
	display: flex
	flex-wrap: wrap
	padding: $builder-gutter 0 0 $builder-gutter
	text-shadow: 0 1px 0 rgba(#fff, .7)
	user-select: none
	ul,
	ol,
	li,
	div
		display: flex
		align-items: center
		flex: 0 1 auto
	& > ul,
	& > ol,
	& > li,
	& > div
		margin: 0 $builder-gutter $builder-gutter 0
	li
		display: flex
		flex: 0 1 auto
	& > li
		.delete
			cursor: pointer
			border-left: 1px solid #ddd
			padding: 0 $quarter-gutter
			height: $line-height
			line-height: $line-height
			font-size: .95em
			display: none
			&:hover
				background: $color-red
				color: #fff
				text-shadow: 0 1px 1px rgba(#000, .5)
		&:hover
			.delete
				display: block
	.icon::before
		line-height: @line-height
	.buttons
		flex: 1 1 auto
		position: relative
	input.text-element
		border: 0
		box-shadow: 0 1px 2px rgba(#000, .1)
		background: rgba(#fff, .4)
		height: 1.85em
		&:focus
			background: rgba(#fff, .8)
		&::-webkit-input-placeholder
			color: rgba(#000, .3)
			text-shadow: 0 1px 0 rgba(#fff, 1)

	// word list style
	&.wordlist
		.str
			box-shadow: 0 1px 2px rgba(#000, .1)
			background: #fff
			.word
				padding: 0 $quarter-gutter

	// sentence style
	&.sentence
		margin: 0 0 $quarter-gutter 0
		.btn
			padding: 0 $quarter-gutter
		.ref
			&:not(.preview)
				box-shadow: 0 1px 2px rgba(#000, .1)
				background: #fff
				.components
					margin: 0 $builder-gutter 0 0
					& > li
						margin: 0 0 0 $builder-gutter
						text-transform: uppercase
						font-size: .7em
						&:first-child
							padding: 0 $builder-gutter
							line-height: 1.6em
						&:nth-child(2)
							font-weight: 700
				.prefix, .suffix
					color: $color-foreground-2
					li
						padding: 0 $builder-gutter
				.prefix
					li
						border-right: 1px solid $color-foreground-3
				.suffix
					li
						border-left: 1px solid $color-foreground-3
			.components
				& > li
					&:first-child
						background: $color-foreground-3
						&.noun
							background: #edc
						&.verb
							background: #deb
						&.adjective
							background: #dee
						&.adverb
							background: #ede
						&.pronoun
							background: #ded
						&.preposition
							background: #fec
						&.conjunction
							background: #fde
						&.determiner
							background: #ddf
		li.str
			&:not(.preview)
				box-shadow: 0 1px 2px rgba(#000, .1)
				background: rgba(#fff, .5)
				font-weight: 700
				position: relative
				.probability
					font-size: .3em
					position: absolute
					top: .1em
					left: .1em
					height: 1em
					line-height: 1em
					text-shadow: none
					padding: .1em
					color: rgba(#000, .2)
				.menu
					font-size: .7em
					padding: 0 $quarter-gutter
					border-left: 1px solid rgba(#000, .1)
					display: none
				&:hover
					.probability
						font-size: .6em
						color: #fff
						background: $color-foreground
					.menu
						display: block
				.string
					padding: 0 $quarter-gutter
		li.typeahead
			flex: 1 1 auto
			input
				background: transparent
				width: 5em
				&::-webkit-input-placeholder
					color: rgba(#000, .5)
		.actions
			.btn
				margin-left: $builder-gutter

// Transform editor design
.transforms
	.transform
		display: flex
		ul.actions
			display: flex
			justify-content: flex-end
			align-self: flex-start
			width: 15em
			.up, .down, .delete
				&::before
					display: block
					font: normal 1em/1.4em $font-icon
					text-align: center
					cursor: pointer
					width: 2em
				&:hover
					&::before
						background: $color-foreground
						color: #fff
			.down::before
				content: '\e804'
			.up::before
				content: '\e805'
			.delete
				&::before
					content: '\e801'
					color: $color-red
				&:hover
					&::before
						background: $color-red
		&:first-of-type .actions .up
			&::before
				visibility: hidden
		&:last-of-type .actions .down
			&::before
				visibility: hidden
	.function,
	.regex
		display: flex
		align-items: center
		margin: 0 0 $quarter-gutter 0
		flex: 1 1 auto
		input, textarea
			flex: 1 1 auto
			font-family: monospace
		textarea
			height: 6em
		input
			width: 20em
	.divider::after
		display: block
		content: 'â†’'
		margin: 0 $quarter-gutter
		line-height: 1em
	.test
		display: flex
		align-items: center
		margin: $quarter-gutter 0
		padding: $quarter-gutter 0 0 0
		border-top: 1px solid $color-foreground-3
		input
			width: 10em
			font-weight: 300
		.transform-test
			font-size: .9em
			&:empty
				&::after
					color: $color-foreground-2
					content: 'waiting for input'
			&:not(:empty)
				background: $color-foreground-3
				padding: 0 $quarter-gutter
	.add-transform
		display: flex

// Generator preview
.generator-preview-buttons
	display: flex
	flex-wrap: wrap
	margin: 0 0 $quarter-gutter 0
	li
		margin: 0 $half-gutter 0 0
		font-size: .8em
		font-weight: 300

#generator-preview-contents:not(:empty)
	padding: $half-gutter
	font-family: $font-quote
	font-size: 1.1em
	background: #fff
	margin-left: -1em

// Context menu triggers
.menu-update-sentence-str,
.menu-update-sentence-ref
	cursor: pointer
	&:hover
		color: $color-foreground-1

// Context menu
.context-menu-list
	display: block
	background: #fff
	box-shadow: 0 0 1px rgba(#000, .5), 0 3px 5px rgba(#000, .08)
	position: absolute
	min-width: 8em

.context-menu-item
	display: block
	padding: 0 $quarter-gutter
	text-shadow: none
	position: relative
	user-select: none
	&.hover
		cursor: pointer
		background: $color-foreground
		& > span
			color: #fff
		& > .context-menu-list
			display: block
	&.context-menu-input
		padding-top: $quarter-gutter
		padding-bottom: $quarter-gutter
		&.hover
			background: transparent
		&:not(:last-child)
			border-bottom: 1px solid $color-foreground-3
		label
			cursor: pointer
			&:hover
				color: $color-foreground-1
		input[type=text]
			border: none
			background: #fff
			box-shadow: inset 0 1px 2px rgba(#000, .3)
			display: block
		input[type=checkbox]
			vertical-align: middle
			margin: 0 $quarter-gutter 0 0
	& > .context-menu-list
		display: none
		right: -5px
		top: 5px
	&.remove
		&.hover
			background: $color-red
	.tag-container
		display: flex
		.label
			white-space: nowrap
			flex: 1 0 auto
		.tag
			white-space: nowrap
			flex: 0 0 auto
			text-align: right
			color: $color-foreground-2
			margin: 0 0 0 $half-gutter

.context-menu-root
	& > li:first-child
		// speech bubble arrow
		$arrow-offset = .4em
		$arrow-width = .5em
		position: relative
		&::before,
		&::after
			content: ''
			position: absolute
			width: 0
			height: 0
			border-style: solid
		&::before

			border-width: $arrow-width
			border-color: transparent rgba(#000, .2) transparent transparent
			left: -(@border-width * 2)
			top: $arrow-offset
		&::after
			border-width: $arrow-width - .05em
			border-color: transparent #fff transparent transparent
			left: -(@border-width * 2) + .05em
			top: $arrow-offset + .05em
		&.hover
			&::after
				border-color: transparent $color-foreground transparent transparent

.context-menu-separator
	margin: ($quarter-gutter / 2) 0
	border-bottom: 1px solid $color-foreground-3

.context-menu-submenu
	& > span
		&::after
			font: normal .8em/2em $font-icon
			vertical-align: top
			content: '\e80f'
			position: absolute
			right: $quarter-gutter

// Magnificent popup
.mfp-hide
	display: none !important

.mfp-bg
	top: 0
	left: 0
	width: 100%
	height: 100%
	z-index: 1042
	overflow: hidden
	position: fixed
	background: rgba(#fff, .8)

.mfp-wrap
	top: 0
	left: 0
	width: 100%
	height: 100%
	z-index: 1043
	position: fixed
	outline: none !important
	-webkit-backface-visibility: hidden

.mfp-container
	top: 0
	left: 0
	width: 100%
	height: 100%
	position: absolute
	display: flex

.mfp-content
	margin: auto
	background: #fff
	box-shadow: 0 0 1px rgba(#000, .5), 0 3px 5px rgba(#000, .08)
	text-align: left
	box-sizing: border-box
	width: 35em

.mfp-close
	display: none

.mfp-transition-zoom-in
	.mfp-content
		transition: all .2s ease-in-out
		transform: scale(.8)
		opacity: 0
	&.mfp-ready .mfp-content
		opacity: 1
		transform: scale(1)
	&.mfp-removing .mfp-content
		opacity: 0
		transform: scale(.8)
	&.mfp-bg
		opacity: .001
		transition: opacity .3s ease-out
		&.mfp-ready
			opacity: .8
		&.mfp-removing
			opacity: 0

// Popup-specific styles
#popup-import
	text-align: center
	input,
	textarea
		width: 100%
	textarea
		font-family: monospace
		height: 6em

#popup-export-json,
#popup-export-generator
	textarea
		font-family: monospace
		width: 100%
		height: 10em
		font-size: .7em
		padding: $half-gutter
	pre
		height: 12em
		font-size: .7em

#popup-export-json
	textarea
		height: 20em

#popup-export-generator
	.export-type
		display: flex
		li
			display: flex
			flex: 1 1 auto
			input
				display: none
				&:checked + label
					font-weight: bold
					color: $color-foreground
					border-bottom: 2px solid $color-foreground
			label
				flex: 1 1 auto
				cursor: pointer
				padding: 0 $half-gutter
				font-size: .8em
				text-transform: uppercase
				color: $color-foreground-1
				&:hover
					color: $color-foreground
				.icon
					margin: 0 $quarter-gutter 0 0

.popup
	padding: $gutter
	.text-wrap
		display: flex
		.text
			flex: 1 1 auto
		.icon
			margin: 0 0 0 $half-gutter
			flex: 0 1 auto
			width: 5em
			text-align: right
			&::before
				display: block
				font: normal 2.8em $font-icon
			&.warn::before
				color: $color-yellow
				content: '\e80b'
			&.error::before
				color: $color-red
				content: '\e80c'
			&.info::before
				color: $color-blue
				content: '\e80d'
			&.question::before
				color: $color-blue
				content: '\e80e'
	.buttons
		margin: $half-gutter 0 0 0
		padding: $half-gutter 0 0 0
		border-top: 1px solid $color-foreground-3
		display: flex
		justify-content: space-between
		button
			padding: 0 $gutter
			height: 2.4em
			font-weight: 700
	.center-header
		text-align: center
		position: relative
		.label
			position: relative
			background: #fff
			z-index: 101
			display: inline-block
			padding: 0 $half-gutter
			font-size: .8em
			text-transform: uppercase
			font-weight: bold
		&::after
			z-index: 100
			content: ''
			width: 100%
			height: 0
			border-bottom: 1px solid $color-foreground-3
			display: block
			position: absolute
			left: 0
			top: 50%

// Typeahead popup
.tt-dropdown-menu
	background: #fff
	box-shadow: 0 0 1px rgba(#000, .5), 0 3px 5px rgba(#000, .08)
	text-transform: uppercase
	font-size: .8em
	max-height: 10.4em
	overflow: auto
	&, & *
		white-space: nowrap !important
	.suggestion
		display: flex
		width: 100%
		.label
			background: $color-foreground-3
			font-weight: bold
			align-self: center
			height: 1em
			line-height: @height
			padding: .2em
		.component
			margin: 0 0 0 $quarter-gutter
			&:not(:nth-child(2))
				&::before
					content: ' / '
		.tag
			flex: 1 1 auto
			text-align: right
			color: $color-foreground-2
			margin: 0 0 0 $quarter-gutter

.tt-suggestion
	min-width: 14em
	white-space: nowrap
	cursor: pointer
	padding: 0 $quarter-gutter
	&.tt-cursor
		background: $color-foreground
		color: #fff
		text-shadow: none
		.label
			background: $color-foreground-1


// new styles
ul.tree
	$inline-padding = .3em
	background: #fff
	padding: $half-gutter
	margin-left: -($half-gutter)
	user-select: none
	.header
		display: flex
		align-items: center
		font-size: .9em
		.name
			flex: 1 0 auto
			font-weight: 700
			text-transform: uppercase
		&:hover
			background: rgba($color-foreground, .05)
			cursor: pointer
		&::before
			font: normal .7em/1em $font-icon
			content: '\e800'
			width: 1.6em
			height: @width
			line-height: @height + .2em
			text-align: center
			margin: 0 ($quarter-gutter / 2) 0 0
			&:hover
				background: $color-foreground-2
	ul.children
		padding: 0 0 0 ($half-gutter / 1.5)
		margin: $inline-padding 0 $inline-padding .45em
		border-left: 1px solid $color-foreground-3
		&.inline
			cursor: default
			background: #f4f2ef
			box-shadow: inset 0 1px 2px rgba(#000, .1)
			display: flex
			flex-wrap: wrap
			display: flex
			flex-wrap: wrap
			align-items: center
			padding: $inline-padding $inline-padding 0 0
			border: 0
			.inline
				// don't pad nested inlines
				padding: 0
				// emphasize shadows on nested inlines to separate them better
				box-shadow: inset 0 0 1px rgba(#000, .4)
				& > .node
					margin: 0
			& > .node
				margin: 0 0 $inline-padding 0
			.node
				flex: 0 1 auto
				.contents
					padding: 0 $quarter-gutter
					font-size: .9em
					background: #fff
					box-shadow: 0 1px 2px rgba(#000, .15)
					margin: 0 $inline-padding 0 0
				&.has-children + .node
					margin-left: $inline-padding
				.icon-plugin
					color: $color-green
					margin: 0 $quarter-gutter 0 0
				.icon-cog
					color: $color-blue
					margin: 0 $quarter-gutter 0 0
	.inline-random,
	.inline-joined
		& > .children.inline
			.inline
				margin: 0 ($quarter-gutter / 2) 0 0
				background: rgba($color-foreground, .08)
				padding: $inline-padding 0 !important
				margin: -($inline-padding) 0
				text-shadow: 0 1px 0 rgba(#fff, .9)
			&::before
				color: $color-foreground-1
				font: normal .8em/1em $font-icon
				display: block
				margin: 0 ($quarter-gutter)
	.inline-random
		& > .children.inline
			&::before
				content: '\e814'
	.inline-joined
		& > .children.inline
			&::before
				content: '\e815'
